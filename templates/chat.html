<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{{ title }}</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-[#121212] text-gray-100 font-sans p-6 space-y-4">
    <div class="flex justify-between items-center p-4">
        <p>Logged in as <b>{{ logged_in_as }}</b> in room {{ room_name }} (#{{ room_id }})</p>
        <form action="/account/logout" method="post">
            <button
                type="submit"
                class="text-sm text-purple-400 hover:text-purple-300 hover:underline"
            >
                Logout
            </button>
        </form>
    </div>

    <div class="flex space-x-2">
        <input
            id="message_text_input"
            placeholder="Type a message..."
            class="flex-grow px-3 py-2 rounded bg-[#1e1e1e] text-gray-100 border border-gray-700 focus:outline-none focus:ring focus:ring-purple-600"
        />
    </div>

    <ul id="messages" class="space-y-2">
        {% for message in messages %}
            <li class="bg-[#1e1e1e] p-3 rounded border border-gray-700">{{ message | safe }}</li>
        {% endfor %}
    </ul>

    <script>
        const websocket = new WebSocket("ws://" + location.host + "/chat/{{ room_id }}/websocket");
        const chat = document.getElementById("messages");
        const input = document.getElementById("message_text_input");

        websocket.onmessage = (event) => {
            const new_message = document.createElement("li");
            new_message.textContent = event.data;
            new_message.className = "bg-[#1e1e1e] p-3 rounded border border-gray-700";
            chat.prepend(new_message);
        };

        input.addEventListener("keydown", event => {
            if (event.key === "Enter" && input.value) {
                websocket.send(input.value);
                input.value = "";
            }
        });
    </script>
</body>
</html>
